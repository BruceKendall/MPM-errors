---
title: Persistent problems in the construction of matrix population models
author:
  - name: Bruce E. Kendall
    email: kendall@bren.ucsb.edu
    affiliation: UCSB Bren
    footnote: Corresponding Author
  - name: Masami Fujiwara
    email: fujiwara@tamu.edu
    affiliation: TAMU Wildlife
  - name: Jasmin Diaz-Lopez
    email: jasmindiazlopez@tamu.edu
    affiliation: TAMU Wildlife
address:
  - code: UCSB Bren
    address: Bren School of Environmental Science & Management, University of California Santa Barbara, Santa Barbara, CA 93106-5131, USA
  - code: TAMU Wildlife
    address: Department of Wildlife and Fisheries Sciences, Texas A&M University, College Station, TX 77843-2258, USA
abstract: |
  Matrix population models (MPMs) are powerful tools for translating demographic and life history information into a form that can be used to address a wide range of research topics, such as projecting population dynamics, evaluating stressor impacts on populations, and studying life history evolution. 
  However, the reliability of such studies depends on the MPM being constructed in a way that accurately reflects the species’ life history. 
  We highlight three errors commonly encountered in published MPMs: (1) failing to include survival in the fertility coefficient; (2) introducing a one-year delay in age at first reproduction; and (3) incorrectly calculating the growth rate out of a stage with a mean development time greater than the model time step. 
  We review the sources of such errors and provide new analyses revealing the impact of such errors on model predictions, using lionfish and American alligator models as examples. 
  These MPM construction issues are treated extensively in textbooks, so their existence in current literature is surprising. 
  To quantify the prevalence of such errors we examined and scored the original publications underlying the models in the COMADRE Animal Matrix Database [add sample sizes (MPMs, species, studies)]. 
  The first two errors were found in 41% and 42%, respectively, of the published studies; all were in models that used a “post-breeding census” representation of the life cycle (in which newborns [eggs, neonates, fledglings, etc.] are explicitly included). 
  Of the studies where stages may last longer than one time step, 25% constructed the growth rate using inappropriate formulas, and 37% used methods that were either undescribed or would generate the correct development time only if the population remained at the observed age-within-stage structure. 
  These results suggest that further efforts may be required to educate biologists on the construction of MPMs, perhaps in concert with the development of new software tools. 
  Furthermore, the conclusions of many studies that are based on MPMs may need to be re-examined, and synthetic studies using the COMADRE Database need to be accompanied by careful examination of the underlying studies.

keywords: COMADRE animal matrix database, Lefkovitch matrix, Leslie matrix, Matrix population models, model construction, model validity
bibliography: Bibliography.bib
csl: ecological-modelling.csl
output: 
  bookdown::pdf_book:
    base_format: rticles::elsevier_article
    keep_tex: true
    fig_caption: true
numbersections: true
layout: "12pt, 1p"
linenumbers: true
tables: true
journal: "Ecological Modelling"
---

```{r knitr_options, echo=FALSE, message=FALSE}
show_code <- FALSE
knitr::opts_chunk$set(echo = show_code, message = show_code, warning = show_code,
                      comment = NA)
```

# Introduction 
The use of matrix population models (MPMs) for the ecological study of plants and animals has expanded rapidly in recent years [@Salguero-Gomez2015; @Salguero-Gomez2016].
MPMs are a convenient way to synthesize demographic information about a population, and are useful in addressing ecological, evolutionary, and management questions [@Caswell2001; @Morris2002a].
Most early MPMs were developed by collaborations between biologists with expertise on the species at hand and modelers with deep understanding of the subtleties of modeling.
MPMs now, having been long promoted as a straightforward translation of life-history information into quantitative analysis, are often being created by biologists who are primarily empirical ecologists or conservation biologists, and may have had little training in modeling beyond a graduate course in population ecology.
One might then ask, do these MPMs reliably reproduce the life histories they are meant to represent? 

It is important to remember that MPMs are approximations, both because they still abstract away much biological detail and because demographic measurements are imprecise. 
There are a variety of subtleties in constructing such models, especially when breeding is spread across a substantial fraction of the year or when there is substantial heterogeneity among individuals within an age or stage class; much theoretical work has gone into making MPMs more complex to account for this, and we are starting to better understand the effects of these phenomena on simple models [e.g., @Fujiwara2017]. 
But even setting aside these issues, we might hope that, if we assume that a simple life history description (e.g., as embodied in an age- or stage-structured life table) is a useful description of the population, then the constructed MPM should accurately reproduce that description. 
If it does not, then we are introducing additional errors into the analysis above and beyond the inherent approximations of modeling.

One of us (BEK) has spent two decades teaching MPMs to applied masters students. 
This experience has revealed several aspects of MPM construction that are particularly challenging to novices, and thus might be similarly challenging to biologists who do not regularly create mathematical models of their system. 
Furthermore, the students, when sent to find a published model to analyze, have uncovered a suprising number of published MPMs that have failed to meet these challenges. 
At one level, the errors made by these novices are "simply" accounting issues, but students exhibit a strong resistance to accepting the correct formulations.
We suspect that this difficulty, for both students and researchers, is rooted in the contrast between the often-loose way that terms are used to describe biological populations and the very precise meanings of terms in MPMs (together with some genuine linguistic ambiguity that plagues the field).

Our goal in this paper is to highlight these challenges (which are described in the next section), quantify their impacts on the outputs of MPMs, and document their prevalence in the peer-reviewed literature. 
We conclude with a discussion of why these MPM construction errors are so prevalent, and how we might improve future practice.

# Challenges in MPM construction
We focus on animal models in which the demography is structured by age [Leslie matrices; @Leslie1945] or developmental stage [Lefkovitch matrices; @Lefkovitch1965]; plant and size structured models present additional complications (although two of the issues presented here still apply).
We also focus on species whose reproduction is concentrated in a short breeding season [so-called "birth-pulse" populations; @Caughley1967]. 
Many animals and plants satisify this assumption, and this allows us to avoid the extra complications associated with using discrete-time models to represent a continuously breeding species. 
Note that by "breeding season" we mean the season in which individuals are born or hatched, not the season during which their parents mate.
Age starts counting from birth, so that a reproductively mature individual breeds on or about their birthday: e.g., if the age at first reproduction is 5 years, then an individual has its first offspring on its fifth birthday.
Therefore, throughout this paper, we assume age is advanced by 1 immediately before birthday. 

MPMs project the population from one nominal census date to the next.
While the census could in principle be at any time, in practice nearly all MPMs either census the population just before breeding ("prebreeding census") or just after breeding ("postbreeding census").
In a prebreeding census, the youngest age class is made up of individuals all with age nearly one, which we designate as age one. 
In a postbreeding census, the first age class would comprise newborn individuals, all of age zero, the second class would comprise individuals of age exactly one, etc.
We refer to newborn individuals with a subscript of zero; as a result, our lifetables and postbreeding Leslie models will look different from most textbooks, which assign newborns to "age class one" and use a subscript of one.

## Ensuring that the fertility coefficient spans a full timestep
```{r lifetable, results='markup', echo=FALSE}
### Make and display a sample life table
sample_life_table <- data.frame(
  Age = c(0:4, "$\\vdots$"),
  Survival = c(0.2, 0.4, 0.4, 0.9, 0.9, "$\\vdots$"),
  Birth = c(0, 0, 0, 3, 3, "$\\vdots$"),
  Stage = c("Newborn", "Juvenile", "Juvenile", "Adult", "Adult",
            "$\\vdots$")
)

names(sample_life_table) <- c("Age in years ($x$)", 
                              "Annual survival ($\\sigma_x$)",
                              "Birth rate ($b_x$)",
                              "Stage")
knitr::kable(sample_life_table, escape = FALSE,
             booktabs = TRUE,  align = c("c", "c", "c", "c"),
             caption = "A sample life table for a species that
             reaches sexual maturity at age 3 (adult stage). 
             Adults continue to survive and
             reproduce indefinitely with the same survival 
             and birth rates.
             Note that, because we are using the 
             stage-structured convention for assigning age 
             class names (see text), the table may look slightly
             different from those in many textbooks.")
```


In a life table (e.g., Table \ref{tab:lifetable}), age specific survival and birth rates look as if they should make equivalent contributions to a population model. 
But there is an important difference: survival (which we donote $\sigma_x$ for Leslie models and $\sigma_i$ for Lefkovitch models, where $x$ is the age and $i$ is stage) represents the fraction of individuals in a class ($x$ or $i$) that survive for a full timestep, from time $t$ to time $t+1$. 
In contrast, the birth rate (which we denote $b_x$ for age-structured demography and $b_i$ for stage-structured demography) is an almost instantaneous event: it is the average number of offspring produced at time $t$ by an individual that is alive at time $t$. 
It is tempting to draw a life cycle graph like the one in Fig. \@ref(fig:lifecycles)a (commonly seen in the literature). 
While this works as a *conceptual* diagram, translating it directly into an MPM by coverting each arrow in the graph into a matrix element is incorrect: each element in the matrix must span a timestep, and $b_x$ does not accomplish that. 

```{r lifecycles, echo=FALSE, warning=FALSE, message=FALSE, fig.cap='Four life cycle graphs that might (correctly or incorrectly) represent the life table in Table 1. (a) A "naive" representation that associates each arrow with a vital rate. This fails to account for the fact that the fertility coefficients must span a timestep and therefor include a survival term. (b) A pre-breeding census representation, in which the youngest censused class is Age 1 and the adult birth rate is multiplied by newborn survival. (c) An "intuitive" post-breeding census representation, in which the adult burth rate is correctly multiplied by adult survival, but which fails to account for the fact that Age 2 individuals will have reproduced (as adults) just prior to the next census. (d) A correct post-breeding census representation.'}
library(diagram)
class_names <- c("Age 0", "Age 1", "Age 2", "Adult")
op <- par(mfrow = c(2,2), mar = c(0.1, 0.1, 1.6, 0.1))

# Common control paramters for the diagrams
# Set them once here so that they can be easily updated
# Unfortunately plotmat() is not scale-independent!
pos = 4
self.shiftx = 0.15
self.shifty = -0.08
self.lwd = 2
self.lwd = 2
self.cex = 1
self.arrpos = NULL
shadow.size = 0.0
relsize = 0.89
mx = -0.05
arr.type = "triangle"
arr.length = 0.2

# "Naive" life cycle diagram
mat1 <- as.data.frame(
  matrix(nrow = 4, ncol = 4, byrow = TRUE, data = 0)
)
mat1[[2,1]] <- "sigma[0]"
mat1[[3,2]] <- "sigma[1]"
mat1[[4,3]] <- "sigma[2]"
mat1[[4,4]] <- "sigma[3]"
mat1[[1,4]] <- "b[3]"
curves <- matrix(0, 4, 4)
curves[2,1] <- curves[3,2] <- curves[4,3] <- 1
curves[1,4] <- 0.5
plotmat(mat1, name = class_names, pos = pos, curve = curves, 
        self.shiftx = self.shiftx, self.shifty = self.shifty, 
        self.lwd = self.lwd, self.cex = self.cex, 
        self.arrpos = self.arrpos, shadow.size = shadow.size, 
        relsize = relsize, mx = mx, arr.type = arr.type,  
        arr.length = arr.length,
        main = "\na) Naive representation (incorrect)")

# Pre-breeding census 
mat2 <- mat1[-1,-1]
mat2[[1,3]] <- "b[3] * sigma[0]"
curves2 <- curves[-1,-1]
curves2[1,3] <- 0.5

plotmat(mat2, name = class_names[-1], pos = 3, curve = curves2, 
        self.shiftx = self.shiftx, self.shifty = self.shifty, 
        self.lwd = self.lwd, self.cex = self.cex, 
        self.arrpos = self.arrpos, shadow.size = shadow.size, 
        relsize = relsize, mx = mx, arr.type = arr.type,  
        arr.length = arr.length,
        main = "\nb) Pre-breeding census representation (correct)")

# "Intuituive" post-breeding census
mat3 <- mat1
mat3[[1,4]] <- "sigma[3] * b[3]"
plotmat(mat3, name = class_names, pos = pos, curve = curves, 
        self.shiftx = self.shiftx, self.shifty = self.shifty, 
        self.lwd = self.lwd, self.cex = self.cex, 
        self.arrpos = self.arrpos, shadow.size = shadow.size, 
        relsize = relsize, mx = mx, arr.type = arr.type,  
        arr.length = arr.length,
        main = "c) Intuitive post-breeding census \nrepresentation (incorrect)")

# Correct post-breeding census
mat4 <- mat3
mat4[[1,3]] <- "sigma[2] * b[3]"
curves[1,3] <- curves[1,4]
plotmat(mat4, name = class_names, pos = pos, curve = curves, 
        self.shiftx = self.shiftx, self.shifty = self.shifty, 
        self.lwd = self.lwd, self.cex = self.cex, 
        self.arrpos = self.arrpos, shadow.size = shadow.size, 
        relsize = relsize, mx = mx, arr.type = arr.type,  
        arr.length = arr.length,
        main = "d) Post-breeding census representation \n(correct)")

par(op)
```

To get the timestep into the fertility coefficient, $b_x$ needs to be multiplied by a survival term---either that of the parent or of the offspring. 
Failing to include survival term will inflate the fertility coeffcients. 
For a pre-breeding census model, the fertility coefficient is $F_x = b_x \sigma_0$: the parent, in class $x$, produces $b_x$ offspring immediately after the census, and then these offspring survive to the end of the timestep at rate $\sigma_0$ (Fig. \@ref(fig:lifecycles)b). 
For an annual timestep, $F_x$ represents the number of one-year-olds next year produced by an individual of age $x$ this year. 

In a post-breeding census, the parent (which will have just reproduced if it is already an adult) must survive for a timestep, aging by a timestep and possibly maturing into a new class, and then reproduces with a birth rate appropriate to its class at the end of the timestep. 
If we use $x'$ to denote the parent's class at time $t+1$, then the fertility coefficient is $F_x = \sigma_x b_{x'}$ (Fig. \@ref(fig:lifecycles)d). For an annual timestep, $F_x$ is the number of zero-year-olds (newborns) produced next year by an individual that was in class $x$ this year. 
Properly accounting for $x'$ is a separate challenge that we address in the next subsection.


## Matching the age at first reproduction to the species' life history
In both stage- and age-structured models, failing to have the fertility coefficient out of the last juvenile class in postbreeding census models (or having another workaround to the problem) will lead to a one-year delay in the age at first breeding, relative to the life history that the model is meant to represent.

In an age-structured population, the lowest age with a non-zero birth rate represents the *age at first reproduction*; we will call that age $x_m$, for "age at [reproductive] maturity." 
In a prebreeding census model (Fig. \@ref(fig:lifecycles)b), this does not present a conceptual challange, as the newly matured, about-to-reproduce-for-the-first-time individuals are already classified as age $x_m$, matching intuition.
However, in a post-breeding census model, the individuals who are age $x_m$ at the end of the timestep, and have just reproduced for the first time, were age $x_m - 1$ at the beginning of the timestep. 
A model that has the first fertility coefficient associated with age $x_m$ (Fig. \@ref(fig:lifecycles)c) results in the modelled age at first reproduction being $x_m + 1$, a year delay relative to the actual life history.
The solution is to add a fertility coefficient linking age class $x_m - 1$ to age class zero---the lower of the two fertility arrows in Fig. \@ref(fig:lifecycles)d. 
Embracing this fertility coefficient requires overcoming cognitive dissonance---"juveniles" are reproducing!---and we have found that students---and perhaps other nonmodellers---actively resist this.


An alternative approach for postbreeding census Leslie models is to change the indexing scheme, associating $x$ with the individual's age at the *end* of the timestep (rather than the age at the beginning of the timestep, as we have done above).
Then the individuals who will mature and reproduce before the next census are called age $x_m$, and their fertility is $F_{x_m} = \hat{\sigma}_{x_m} b_{x_m}$ (we use $\hat{\sigma}$ for survival to clarify that it is a differently indexed parameter from $\sigma$ as used above).
Thus, the cognitive dissonance is finessed by "hiding" the fact that these individuals started the timestep as juveniles.
Indeed, many textbooks use this indexing convention.
However, this alternative indexing convention cannot be maintained when moving from age-structured to stage-structured models, as not all individuals that start the timestep as juveniles will end it as adults.

So let us look at stage-structured models.
The simplest stage-structured model has newborns, a nonreproductive juvenile class that spans multiple timesteps, and reproductive adults (Fig. \@ref(fig:SScycles)).
Within the juvenile class, some individuals remain juveniles in the next timestep (should they survive), whereas others mature into adults.
If $\gamma_J$ is the fraction surviving individuals that mature ("grow") at the end of the timestep, then the Juvenile--Juvenile transition is given by $P_J = \sigma_J (1-\gamma_J)$ and the Juvenile--Adult transition is given by $G_J = \sigma_J \gamma_J$. 
We will treat the estimation of $\gamma_J$ in the next section.
As in age-structured models, the fertility coefficient needs to include a survival term, so Fig. \@ref(fig:SScycles)a is incorrect.
In a prebreeding census model, the adult birth rate must be multiplied by newborn survival, and newborns removed from the stage vector (Fig. \@ref(fig:SScycles)b), whereas in a postbreeding census model, the birth rate must be multiplied by the parent's suvival (Figs. \@ref(fig:SScycles)c-d).

If the criterion for being classed as "adult" is that the individual can reproduce, then just-matured adults should have non-zero fertility. 
In the prebreeding census model (Fig. \@ref(fig:SScycles)b), the individuals that have just matured (made the transition from Juvenile to Adult) will reproduce at the beginning of the next timestep.
However, in the intuitive postbreeding census model (Fig. \@ref(fig:SScycles)c), the individuals that just matured won't reproduce until the end of the next timestep, a full timestep after their transition to adulthood. 
In reality, the individuals that just made the Juvenile--Adult transition were already adults at the just-passed breeding season, and hence have had their first opportunity to reproduce.
To represent this, we need a fertility coefficient leading out of the juvenile class---$F_J = G_J b_A$ (Fig. \@ref(fig:SScycles)d)---which again seems to defy common sense.
Although this is the texbook solution, there a number of other ways one might finesse this issue, such as classifying individuals as adults at the beginning of the timestep in which they mature, or creating a special "pre-adult" class between juveniles and adults.
However, these methods introduce additional complications such as giving the maturing juveniles adult survival rather than juvenile survival (which might or might not be desireable), or shortening the "juvenile" stage duration to account for the extra stage.

```{r SScycles, echo=FALSE, warning=FALSE, message=FALSE, fig.cap='Four life cycle graphs that might (correctly or incorrectly) represent stage structured life table in Table 1. (a) A "naive" representation that associates each arrow with a vital rate. This fails to account for the fact that the fertility coefficients must span a timestep and therefor include a survival term. (b) A pre-breeding census representation, in which the youngest censused class is the juvenile stage and the adult birth rate is multiplied by newborn survival. (c) An "intuitive" post-breeding census representation, in which the adult burth rate is correctly multiplied by adult survival, but which fails to account for the fact that the maturing juveniles will have reproduced (as adults) just prior to the next census. (d) A correct post-breeding census representation.'}
library(diagram)
class_names <- c("Newborn", "Juvenile", "Adult")
op <- par(mfrow = c(2,2), mar = c(0.1, 0.1, 1.6, 0.1))

# Common control paramters for the diagrams
# Set them once here so that they can be easily updated
# Unfortunately plotmat() is not scale-independent!
pos = 3
self.shiftx = 0.
self.shifty = -0.15
self.lwd = 2
self.lwd = 2
self.cex = 1
self.arrpos = -1.6
shadow.size = 0.0
relsize = 1
mx = 0
arr.type = "triangle"
arr.length = 0.3

# "Naive" life cycle diagram
mat1 <- as.data.frame(
  matrix(nrow = 3, ncol = 3, byrow = TRUE, data = 0)
)
mat1[[2,1]] <- "sigma[N]"
mat1[[2,2]] <- "P[J]"
mat1[[3,2]] <- "G[J]"
mat1[[3,3]] <- "sigma[A]"
mat1[[1,3]] <- "b[A]"
curves <- matrix(0, 3, 3)
curves[2,1] <- curves[3,2] <- 0.1
curves[1,3] <- 0.5
plotmat(mat1, name = class_names, pos = pos, curve = curves, 
        self.shiftx = self.shiftx, self.shifty = self.shifty, 
        self.lwd = self.lwd, self.cex = self.cex, 
        self.arrpos = self.arrpos, shadow.size = shadow.size, 
        relsize = relsize, mx = mx, arr.type = arr.type,  
        arr.length = arr.length,
        main = "\na) Naive representation (incorrect)")

# Pre-breeding census 
mat2 <- mat1[-1,-1]
mat2[[1,2]] <- "b[A] * sigma[N]"
curves2 <- curves[-1,-1]
curves2[1,2] <- 0.5

plotmat(mat2, name = class_names[-1], pos = pos-1, curve = curves2, 
        self.shiftx = self.shiftx, self.shifty = self.shifty, 
        self.lwd = self.lwd, self.cex = self.cex, 
        self.arrpos = self.arrpos, shadow.size = shadow.size, 
        relsize = relsize, mx = mx, arr.type = arr.type,  
        arr.length = arr.length,
        main = "\nb) Pre-breeding census representation (correct)")

# "Intuitive" post-breeding census
mat3 <- mat1
mat3[[1,3]] <- "sigma[A] * b[A]"
plotmat(mat3, name = class_names, pos = pos, curve = curves, 
        self.shiftx = self.shiftx, self.shifty = self.shifty, 
        self.lwd = self.lwd, self.cex = self.cex, 
        self.arrpos = self.arrpos, shadow.size = shadow.size, 
        relsize = relsize, mx = mx, arr.type = arr.type,  
        arr.length = arr.length,
        main = "c) Intuitive post-breeding census \nrepresentation (incorrect)")

# Correct post-breeding census
mat4 <- mat3
mat4[[1,2]] <- "G[J] * b[A]"
curves[1,2] <- curves[1,3]
plotmat(mat4, name = class_names, pos = pos, curve = curves, 
        self.shiftx = self.shiftx, self.shifty = self.shifty, 
        self.lwd = self.lwd, self.cex = self.cex, 
        self.arrpos = self.arrpos, shadow.size = shadow.size, 
        relsize = relsize, mx = mx, arr.type = arr.type,  
        arr.length = arr.length,
        main = "d) Post-breeding census representation \n(correct)")

par(op)
```


## Ensuring that the mean time in each developmental stage matches the species' life history
The final challenge is associated with estimating $\gamma_x$, the fraction of individuals maturing out of stage $x$.
In many cases, the goal is to combine information on stage-specific survival, often variously collected, with knowledge about the stage duration (the number of timesteps that individuals remain in a stage before maturing).
If stage durations are fixed (e.g., all individuals mature after two years as juveniles), then the goal is to create a "stage-for-age" model [e.g., @Ebert1998, Ch. XXX] where the mean stage duration in the model equals the fixed stage duration in the life history.
If the real stage durations are variable, then the goal is to create a model where the mean stage duration in the model equals the mean stage duration in the life history (in principle, the model should also match the variance in stage duration, but this seems never to be done in practice).


@Caswell2001 has a section of his book describing various ways of doing this.
When the life history contains fixed stage durations, there is no single "best" approach, as the stage-structured model will never match the age-structured model completely.
Nevertheless, the primary analyses performed on most published MPMs are to calculate the asymtotic growth rate ($\lambda_1$) and the sensitivity of $\lambda_1$ to underlying demographic parameters. 
For these calculations, there is one (and only one) recipe to create a stage-structured model that will generate the same results as the equivalent age-structured model with fixed stage durations. [LOOK FOR EVIDENCE OF THIS]
As best we can tell, it was first introduced by @Caswell1989, although its first application to an ecological populaton may have been by @Crowder1994. 

**MAKE TABLE WITH FORMULAS AND ASSUMPTIONS OF THE MODELS**

The basic idea is that $\gamma$ represents the fraction of individuals in the stage that have spent enough time in the stage to mature. 
This, in turn, depends on the (implicit) age structure within the stage.
In general, this age structure could have any form, depending on the recent history of the population; the one case in it is well defined is when the population is at the stable age/stage distribution.
This is exactly the condition under which $\lambda_1$, the asymptotic growth rate, is the population growth rate.
Under these conditions, there are two factors that affect the age distribution within the stage, and hence the fraction of individuals of an appropriate age to mature.
The first is the stage-specific mortality, which determines how a cohort shrinks as it ages.
The second is the asymptotic growth rate, which determines the degree to which one year's entering cohort is larger or smaller than the previous one under the stable age or stage distrubution.
This makes $\gamma$ non-trivial to calculate, as the resulting formula involves $\lambda_1$, which can only be calculated once the MPM has been constructed and calibrated on data!
The solution is an iterative approach: take an initial guess of $\lambda_1$, calculate $\gamma$ from the formula; calculate the dominant eigenvalue of the resulting matrix; use that as a new guess for $\lambda_1$; and repeat until the value of $\lambda_1$ stops changing.
We will refer to this as the "asymptotic age-within-stage structure" (AAS) model.

The iterative nature of the AAS model may be daunting to non-modellers, especially those trained before the emergence of quantitative ecology using R.
Such researchers may be tempted by easier-to-calculate formulas. 
Some discover a predecessor to the above Crowder et al. approach that appears in @Crouse1987.
This formula is complex-looking but straighforward to calculate, as it doesn't require iteration (it incorporates the within-cohort dynamics, but *assumes* that $\lambda_1 = 1$).
We will refer to this as the "stationary age-within-stage structure" (SAS) model (where "stationary" means that the population is neither growing nor declining).

An even simpler approach is to say that, if the desired duration of stage $i$ is $T_i$ timesteps, then the fraction maturing is $1/T_i$ (@Caswell2001). 
This relationship between the mean residence time (stage duration) and the fraction departing (maturing) is true for a simple Markovian departure process (REFERENCE - any stochastic process book will work). 
However, for the population process, different number of individuals are entering into the stage as a population may be growing or declining and individuals can also die before maturing. 
Consequently, this particular relationship between the mean duration and fraction maturing is correct under asymptotic conditions if $\sigma_i / \lambda_1 = 1$.
We will refer to this as the "flat age-within-stage structure" (FAS) model.

A rather different approach to estimating $\gamma_i$ does not explicitly attempt to match the mean stage duration, but instead merely estimates $\gamma_i$ as the observed fraction of surviving individuals in the stage that mature to the next stage.
This repeated observations of marked individuals, and might make use of tools such as multistate capture-mark-recapture models (CITE).
As long as the modelled age-within-stage distribution remains the same as it was during the observation period, then the model will get the mean stage duration correct.
However, whereas the observed fraction maturing will change as the age-within-stage distribution changes in the actual population, changes in the modeled age-within-stage distribution will not be reflected in changing maturation fraction.
We will refer to this as the "observed age-within-stage structure" (OAS) model.

As mentioned above, only the AAS model will replicate $\lambda_1$ and its sensitivities from the fully age-structured model.
Of course, a final approach, if the stage durations really are fixed, is to "unroll" the stage, replacing the single stage class with $T_i$ age classes with identical survival coeffiecients (or, if the assumption of homogenous survival within the stage was an approximation, with actual age-specific survival coefficients).
After analysis, the age classes can be collapsed back to their stage to generate a stage structure or sensitivity analyses that are stage-specific rather than age-specific.

# Consequences of incorrect MPM construction
We evaluate the impacts of these errors in MPM construction by examining several endpoints that many analyses focus on: the asymptotic population growth rate ($\lambda_1$), sensitivity analysis of $\lambda_1$ to changes in underlying vital rates, and life history statistics such as generation time. 
We approach this evaluation through theoretical analysis (where feasible and informative) and by examining two case studies: a lionfish (*Pterois* sp.) model with very high population growth [@Morris2011] and a pair of American alligator (*Alligator mississippiensis*) models that project rapdily declining and nearly constant population dynamics, respectively [@Dunham2014]. 
These studies made all three of the errors described above; we singled them out not because they are particularly egregious (many other studies make these errors) but because the authors did an exceptional job of describing the species' life history, allowing us to infer the model they meant to construct.
We started with the original matrices as "baseline" models, and constructed models that fixed one, two, or three of the focal errors to see how these errors affect the model projections and conclusions.

A matrix population model for lionfish was constructed by @Morris2011 to investigate the potential approaches for controlling the invasive species. 
The modeled life history consists of three stages (larvae, juvenile, and adult), and time step of the model is one month. The original model was a post-breeding census model, but it did not include the survival of adults in the fertility rate. 
The average duration of the juvenile stage was assumed to be 12 months in the model. 
This meant they take 14 months for the first reproduction (one month in larvae stage, 12 months in juvenile stage, and one additional month in fertility rate) even though they start reproducing in 12 months. 
The authors used FAS model for calculating the transition rates for juveniles. 
We developed four stage-structured population models that gradually correct for some or all of these problems and one Leslie matrix (Table \@ref(tab:ModelList)). 
Along with the original models, we used the six models to calculate $\lambda_1$, stable stage distribution, reproductive value, sensitivity and elasticity of $\lambda_1$ to stage-specific survival rate and fecundity, damping ratio, and generation time (Appendix 1). 

For American alligator populations, @Dunham2014 developed two stage-structured matrix population models to compare the status of northern and southern populations. 
The original models consist of five stages (eggs, larvae, juvenile, subadults, and adults), and the time step of the model is one year.
Similarly to the lionfish model, the alligator models are post-breeding census models, but the authors did not include the survival of adults in the fertility rate. 
The first stage was egg stage, but it only lasted for three months; therefore, there was clear inconsistency in the time steps among stages. 
@Dunham2014 used AAS model to calculate transition rates for juvenile and subadult stages.
We developed two additional stage-structured models that corrects some or all of these problems and one Leslie matrix for each population (Table \@ref(tab:ModelList)). 
The four population models for each population were used to calculate the same quantities that we calculated with the lionfish models (Appendix 1). 



Table: (\#tab:ModelList) List of models and description of changes made to the original models.

 ---------------------------------------------------------------------------------------------------------------------------------
  Population                      Model   Description
  ------------------------------- ------- -----------------------------------------------------------------------------------------
  Lionfish                        L1      -   Original three-stage model in Morris et al., 2011
                                          
                                          

                                  L2      -   Correction of juvenile duration
                                          
                                          -   Incorporation of adult survival in fertility rate
                                          
                                          

                                  L3      -   All of the corrections in L2
                                          
                                          -   Incorporation of fertility rate of juvenile stage
                                          
                                          

                                  L4      -   All of the corrections in L3
                                          
                                          -   Use of SAS model for calculating juvenile transition rate
                                          
                                          

                                  L5      -   All of the corrections in L3
                                          
                                          -   Use of AAS model for calculating juvenile transition rate
                                          
                                          

                                  L6      -   Leslie matrix
                                          
                                          

  American Alligator (Northern)   A1      -   Original five-stage model in Dunham et al. 2014
                                          
                                          

                                  A2      -   Reduction in the number of stage to four (hatchling, juvenile, subadult, and adult)
                                          
                                          -   Incorporation of survival rate into fertility rate of adult stage
                                          
                                          -   Addition of fertility rate to subadult stage
                                          
                                          

                                  A3      -   All of the corrections made in A2
                                          
                                          -   Calculation of juvenile transition rates using AAS model
                                          
                                          

                                  A4      -   Leslie matrix
                                          
                                          

  American Alligator (Southern)   A5      -   Original five-stage model in Dunham et al. 2014
                                          
                                          

                                  A6      -   Reduction in the number of stage to four (hatchling, juvenile, subadult, and adult)
                                          
                                          -   Incorporation of survival rate into fertility rate of adult stage
                                          
                                          -   Addition of fertility rate to subadult stage
                                          
                                          

                                  A7      -   All of the corrections made in A6
                                          
                                          -   Calculation of juvenile transition rates using AAS model
                                          
                                          

                                  A8      -   Leslie matrix
                                          
                                          
  ---------------------------------------------------------------------------------------------------------------------------------




## Effects on asymptotic population growth rate ($\lambda_1$) 
The failure to include survival terms in the fertility coefficients will make those coefficients too large (since survival is less than one).
This will lead to an overestimate of $\lambda_1$.
This error most often occurs in postbreeding census models, and will be approximately
$$
\mathcal{E}_{\text{surv}}(\lambda_1) \approx \sum_x \left(1 - \sigma_x \right) F_x S_{F_x},
$$
where $S_{F_x}$ is the sensitivity of $\lambda_1$ to the fertility coefficient $F_x$.
Thus, if the survival terms are close to one (as they often are for adults) and the sensitivity of the asymptotic growth rate to survival is small [as it often is; e.g., @Caswell2001, Figs. 9.2 and 9.3 shows sensitivity to fertility having values no more than 0.2, and often much lower], then this error should generally be fairly small.

The failure to allow individuals to reproduce when they first reach reproductive age will have two consequences: $R_0$, the net reproductive rate, will be reduced slightly; and the mean generation time, $T_G$, will be increased by a timestep.
Both effects contribute to an underestimate of $\lambda_1$; the error is approximately
$$
\mathcal{E}_{\text{mature}}(\lambda_1) \approx R_0^{1/T_G} - 
\left(\sigma_A R_0 \right)^{1/(T_G+1)},
$$
where $\sigma_A$ is the one timestep survival of the newly matured class. This doesn't simplify easily, but it is clearly largest when the generation time is short or $R_0$ is large.

If the stage durations are fixed, such that a Leslie matrix model, with all age classes within the stage having the same survival, is the best model, then only the AAS stage-structured model will give the correct $\lambda_1$ in general. 
The SAS model will be correct only if $\lambda_1 = 1$; if $\lambda_1 >1$, then the maturation fraction will be too large and $\lambda_1$ will be overestimated; the opposite will be true if $\lambda_1 < 1$. 
Thus the SAS model will bias $\lambda_1$ away from one. 
The FAS model is similar, except that the critical value for $\lambda_1$ is $\sigma_i/T_i$ [CHECK]. 
If there is more than one multi-timestep stage, with different critical values of $\lambda_1$, then the effects of the FAS model are unclear.
The impact of using the observed transition rates is likely to be highly variable, depending on the nature of the deviations between the age structure when the population was observed and the asyptotic age structure.

The original lionfish model (L1) had $\lambda_1$ of 1.125; this meant they grew by 12.5% each month (Figure S1). 
Even though they are invasive species and rapidly expanding. 
The population growth rate is unrealistically high. 
By reducing the average duration in juvenile stage (L2) and incorporating fertility rate on juvenile stage, the population growth rate increased further (L3). 
However, the use of SAS model to calculate the juvenile transition rate (L4) reduced $\lambda_1$ substantially. 
This is because for the duration of the juvenile stage (11 time steps on average), the survival rate is low. 
Incorporation of $\lambda_1$ in calculation of the transition rates (AAS models; L5) reduced $\lambda_1$ because $\lambda_1 \gg 1$. 
This meant that there was an increase in number of individuals recruited into juvenile stage from larval stage; therefore, the actual age-distribution declines faster with age than the stable age distribution. 
The Leslie matrix (L6, which is expected to be least prone to the errors associated with the manipulations of parameters, and model L5 had the same $\lambda_1$.

The original alligator models had $\lambda_1$ of 0.87 for the northern population and 1.02 for the northern population (Figure S8). 
In contrast to lionfish example, $\lambda_1$ was affected very little with the corrections. 
Changes in the fertility rate had very little effect because $\lambda_1$ was not sensitive to fertility rate. 
Changes in the transition rates for juvenile and subadult stages had little effect because, for the short durations in the stages (7 years in each stage and 3 years in each stage for northern and southern populations, respectively), they had relatively high survival rates (0.78 and 0.73 for juvenile and subadult stages of both populations). 


## Effects on sensitivity analysis of $\lambda_1$
Calculating the sensitivity (or elasticity) of $\lambda_1$ to changes in matrix elements or underlying demographic parameters is often the primary goal of constructing and MPM, especially for management applications or studies of life history theory.
Predicting the effects of MPM construction errors requires information about the second derivative of $\lambda_1$ with respect to model parameters, the theory of which has not been much developed. [CHECK CASWELL SECTION ON THIS]
One unambiguous effect is that failing to include survival terms in the fertility coefficients will lead to underestimates of the sensitivity (and elasticity) of $\lambda_1$ to survival.

Similarly to the results on $\lambda_1$, sensitivity and elasticity of $\lambda_1$ to stage-specific survival and fecundity were affected more for lionfish than alligator. 
For lionfish population, the rank order of both sensitivity and elasticity among stages changed from L3 to L4 as we changed the way we calculate the transition rates (Figures S4 & S5). 
This implies that conservation strategy can be affected by the errors in developing a population matrix. 

For lionfish models, changes in sensitivity and elasticity are less clear (Figures S11 & S12), but stable stage distribution (Figure S9) and reproductive values (Figure S10) are affected by the errors. 
These quantities are used for calculating sensitivity and elasticity of $\lambda_1$. 
For example, the original model substantially under-estimated the stable stage distribution and over-estimated the reproductive value of adults.

## Effects on estimated generation time
A variety of life history statistics, such as generation time ($T$) and net reproductive rate ($R_0$), are key quantities in comparative studies of population demography.
Since these quantities are commonly estimated by analyzing MPMs [e.g., @Salguero-Gomez2016a], it is critical to understand how sensitive these estimates are to errors in MPM construction.
Here, we focus on generation time.
It is not obvious that leaving survival out of the fertility coefficients should have much impact on generation time (although it will lead to an overestimate of $R_0$).
Failing to allow maturing individuals to reproduce will delay the entire reproductive schedule by a timestep, resulting in roughly a one-timestep overestimate of generation time.
Previous work suggests that age-structured models provide more reliable generation time estimates than do the corresponding stage-for-age models [@Fujiwara2017], although the estimates were fairly accurate when the assumption of homogenous demography within a stage was satisfied (as we have done here). 

There are a variety of ways to define generation time in demographic studies [@Coale1972].
In this study, we used the mean age of mothers to represent the generation time, applying formulas developed by @Bienvenu2015. 
We found substantial variations among the stage-structured models.
For the lionfish population, all of the stage-structured models substantially underestimated (by as much as 50%) the generation time relative to the age-structured model (Fig. S7). 
However, the bias was greatest under models L1-L3, which contain the most errors. 
For the alligator populations, the deviations of generation time estimates between the stage-structured mdoels and the age-structured models were more modest (Fig. S14).
Although the same types of errors/approximations were incorporated in the models for northern (from A1 to A3) and southern populations (from A5 to A7), the changes in estimated generation time was not consistent between the two populations. 
For example, it increased from A1 to A2 whereas it decreased from A5 to A6, suggesting simple predictions of how various errors introduced in constructing population matrix would affect the generation time are challenging. 

## Effects on transient dynamics
The asymptotic growth rate and its sensitivity to underlying parameters are relevant to a population's dynamics when the population is at the stable age or stage distribution.
However, in real populations subject to environmental variability or perturbations of abundance, many applications depend on knowing about the population's transient dynamics when it is far from the stable distribution.
There are a range of approaches to quantifying transient dynamics [@Stott2016]; here we focus on the one of the simplest, the damping ratio, which measures how quickly transient dynamics dissipate over time.
The damping ratio is given by $\lambda_1/\left|\lambda_2\right|$, where $\lambda_1$  is the eigenvalue of the largest magnitude and $\lambda_2$  is that of the second largest. 

For lionfish, $\lambda_1$  remained almost the same between L1 and L2, but the damping ratio changed between them indicating the reduced juvenile duration also reduced the magnitude of $\lambda_2$. 
Between L5 and L6, $\lambda_1$ and stable stage distribution were almost the same, but there was reduction in damping ratio, indicating the conversion from age-structured (L6) to stage-structured (L5) models influenced the damping ratio. 
Nevertheless, among all stage-structured model, L5 approximated damping ratio closest to that under L6. 

The damping ratio of the alligator models between northern (A1-A4) and southern (A5-A8) populations changed differently. 
For example, there were larger changes for southern population than northern population, indicating it is difficult to predict how the damping ratio is affected among stage-structured models. 
Interestingly, the models with the most errors (A1 and A5) had the damping ratios closest to that of age structured models (A4 and A8, respectively). 
However, this is probably because stage-structured model generally overestimate damping ratio because the number of types (age and stage classes) is reduced from age- to stage-structured models, allowing a population to converge quickly to the asymptotic dynamics. 
However, the errors were introduced to A1 and A5 to increase the duration of pre-adult stages, which caused the damping ratio to be underestimated.
The bias associated with stage-structured models and the introduced errors in constructing the stage-structured models probably cancelled each other. 

# Prevalence of construction errors in published MPMs
## Methods
To evaluate the prevalence of these errors in published MPMs, we examined a sample of the studies contaned in the COMADRE animal matrix model database [@Salguero-Gomez2016]. 
Using version 2.01 of the database, we subset the data to studies of nonhuman animals that had a DOI (as a simple filter to eliminate non-peer-reviewed studies). 
This left 65 studies published prior to the year 2000, and roughly twice that number published from 2000 to 2018. 
We retained all of the 20th century studies and took a random sample of 60 of the 21st century studies. 
Although many studies publish multiple models, representing different sites or species, we take the study as the unit of observation, as a similar approach was usually taken in all the models within a publication.
Some of the studies did not actually contain MPMs (the models in COMPADRE were constructed by the COMPADRE staff based on information in the cited paper); we eliminated these.

Using a haphazard subset of studies, we developed a protocol to systematically assess each study (Appendix 2). 
This protocol was applied by 3 members of the COMADRE digitization team, all graduate students in demography at the Max Planck Institute for Demographic Research.
After initial training, consistency was ensured by having all members of the team, as well as the lead author of this paper, independently apply the protocol to the same set of papers until all were getting consistent results.
If a question didn't apply (e.g., if it was not a stage-structure model), the answer was coded "NA;" if the answer could not be determined from the information in the publication, it was coded as "unknown."

We coded a model as a postbreeding census if the first age or stage class appeared to be newborn (e.g., eggs, neonates) or a small fraction of a timestep old (e.g., hatchlings, larvae, fledglings).
We coded a model as a prebreeding census if the first age or stage class appeared to be one timestep old (e.g., yearlings, juveniles, 1-year-olds).
While a number of other breeding models are possible, in practice nearly all models fell into one of these categories.

We examined the MPM to determine whether the fertility coefficients contained survival terms, and if so, whether they were appropriate to the model type.
If the appropriate survival term was not present, we coded the model as "incorrect."

To identify the the first reproductive stage or age class that was reproductive, we examined quantitative (e.g., a life table) or qualitative (e.g., text description of the life history) information about the species, as presented in the study.
For postbreeding census models, we then asked whether the individuals maturing into that reproductive class had a nonzero fertility coefficient.
Models lacking this fertility coefficient were coded as "incorrect."

For stage-structured models in which there was a target mean stage duration, we examined textual model descriptions and symbolic representations of the model to determine whether it was constructed using the AAS, SAS, FAS, or OAS formulations, or whether the stages were "unrolled" into a Leslie matrix formulation.
We examined the frequency of all furmulations, and coded AAS and unrolled models as "correct" from the perspective of calculating the asymptotic growth rate, $\lambda_1$.

For each of the three classes of errors, we calculated the overall percentage of relevant studies (i.e., studies that had a structure potentially subject to the error, and for which we could clearly determine how the model was constructed) that made that error.
We also used logistic regression of error classification against publication year to examine whether these errors had become more or less frequent over time.

## Results
*Note: The data collection by the Compadrinos is ongoing. Here we report an analysis based on data collected for the initial feasibility study for the project. The publications are recent and haphazardly chosen, but for this preliminary review we have analyzed and presented these data in the same form that we plan for the final dataset.*

```{r get_data}
library(xlsx)
library(magrittr)
library(tidyverse)
data_file <- "MPM_errors_in_lit.xlsx"
mpm_data <- as.tibble(read.xlsx(data_file, 1))
```

```{r error_stats}
error_stats <- function(errmodel) {
  error.perc <- round(mean(errmodel$model[[1]]) * 100)
  error.n <- length(errmodel$model[[1]])
  error.P <- round(summary(errmodel)$coef[2,4], 3)
  error.trend <- if (error.P > 0.05) {
    "had no detectable trend"
  } else if (coef(errmodel)[2] > 0) {
    "increased"
  } else {
    "decreased"
  }
  return(list(perc = error.perc,
              n = error.n,
              P = error.P,
              trend = error.trend))
}
```

```{r rep_in_fec}
## Errors in fecundity term
mpm_data %<>% mutate(
  FecCorrect = (CensusType == "Pre" & SurvInRep == "Offspring") |
    (CensusType == "Post" & SurvInRep == "Parent")) 
mpm_data <- within(mpm_data, 
                 FecCorrect[SurvInRep %in% c("Unknown", "Not Applicable")] <- NA)
FecErrors.glm <- glm(!FecCorrect ~ YearPublication, data = mpm_data, 
                      family = "binomial")

FecErrors <- error_stats(FecErrors.glm)
FecErrors$post <- (sum(
    with(mpm_data, CensusType[!FecCorrect] == "Post"), na.rm = TRUE
  ) / sum(!mpm_data$FecCorrect, na.rm = TRUE)) * 100

```

```{r mat_age}
### Errors in age at maturity
mpm_data_post <- mpm_data %>% 
  filter(CensusType == "Post") %>%
  mutate(
    ReproWithMatLogical = as.logical(recode(ReproWithMaturation, 
                                          "Not Applicable" = "NA", 
                                          Unknown = "NA", 
                                          Yes = "TRUE", 
                                          No = "FALSE")) 
)

ReproWithMatErr.glm <- glm(!ReproWithMatLogical ~ YearPublication, 
                           data = mpm_data_post, family = "binomial")
ReproWithMatErrors <- error_stats(ReproWithMatErr.glm)
```

```{r stage_duration}
mpm_data_ls <- mpm_data %>%
  filter(!LongStages %in% c("0", "None")) %>%
  mutate(
    GrowthTransition = recode(GrowthTransition,
                              Cohort = "SAS",
                              "1/T" = "FAS",
                              "Caswell6.103" = "AAS")
  ) %>% droplevels()

mpm_data_ls2 <- mpm_data_ls %>%
  filter(GrowthTransition != "Unknown") %>% 
  mutate(GTcorrect = GrowthTransition %in% c("AAS", "Unrolled")) %>%
  droplevels()

MatDurErr.glm <- glm(!GTcorrect ~ YearPublication, 
                           data = mpm_data_ls2, family = "binomial")
MatDurErrors <- error_stats(MatDurErr.glm)

```
We were able to unambiguously identify the components of the fecundity term in `r FecErrors$n` studies.
`r FecErrors$perc`% of these studies failed to include an appropriate survival component in the fertility coefficients; `r FecErrors$post`% of these errors were in post-breeding census models.
The frequency of these errors `r FecErrors$trend` over time ($P =$ `r FecErrors$P`; Fig. \@ref(fig:regplots)a).

The potential for missing the reproductive event associated with first reaching reproductive age is only a feature of post-breeding census models.
Of the `r ReproWithMatErrors$n` studies in which we could unambiguously determine both the last pre-reproductive stage or age class and in which we could identify fertility coefficients, `r ReproWithMatErrors$perc`% made this error.
The frequency of these errors `r ReproWithMatErrors$trend` over time ($P =$ `r ReproWithMatErrors$P`; Fig. \@ref(fig:regplots)b).

`r nrow(mpm_data_ls)` studies included models having at least one stage class that was meant to last for multiple timesteps; we were able to unambiguously classify the rule defining the maturation rate out of the stage(s) in `r MatDurErrors$n` of them.
Of these, `r MatDurErrors$perc`% did not use a rule that would generate a value of $\lambda_1$ that would match an age-structured model with the target mean stage duration (Fig. \@ref(fig:matdist)).
The frequency of these errors `r MatDurErrors$trend` over time ($P =$ `r MatDurErrors$P`; Fig. \@ref(fig:regplots)c).


```{r regplots, fig.asp=1, fig.cap='Trends in matrix population model construction errors through time. Trend line is logistic regression; vertical lines represent the data (jittered horizontally to prevent overlap). (a) Frequency of errors in the fertility coefficient, among all studies. (b) Frequency of errors in timing of first reproduction, among studies with post-breeding census models. (c) Frequency of errors in mean stage duration, among studies with stage classes having mean stage durations > 1 timestep.'}
## Make plots
# Create a function for the plot
# Have x label only for last, y label only for middle
ts_plot <- function(dataset, aesthetic, xlabel = "", ylabel = "") {
  ggplot(dataset, aesthetic) + 
    geom_jitter(width = 0.05, height = 0, shape = "|", size = 2) +
    geom_smooth(method = "glm",  method.args = list(family = "binomial")) +
    theme_classic()  + xlab(xlabel) +
    ylab(ylabel) # + xlim(2010.95, 2015.05)
}
p1 <- ts_plot(mpm_data, aes(YearPublication, as.numeric(!FecCorrect)))
p2 <- ts_plot(mpm_data_post, aes(YearPublication, as.numeric(!ReproWithMatLogical)),
              ylabel = "Frequency of MPM construction errors")
p3 <- ts_plot(mpm_data_ls2, aes(YearPublication, as.numeric(!GTcorrect)),
              xlabel = "Publication Year")


library(ggpubr)
ggarrange(p1, p2, p3, ncol = 1, nrow = 3, labels = "auto", label.x = 0.95)
```

```{r matdist, fig.cap='Frequency of approaches for setting maturation rates from stages with mean duration exceeding one timestep. See section 2.3 and Table XXX for descriptions of the approaches. Only the "Unrolled" and "AAS" approaches generate mean stage durations that match the target life history when the population is at the stable stage distribution.'}
ggplot(mpm_data_ls2, aes(GrowthTransition)) + 
  geom_bar(aes(group=factor(0), y = ..prop..), fill = "white", colour = "black") +
  theme_classic() +
  xlab("Maturation rule") + ylab("Frequency") +
  scale_x_discrete(limits = c("Unrolled", "AAS", "Observed", "SAS", "FAS", "Other"))
```

# Discussion
*[This outline will be fleshed out in the final version!]*

A.  Summary of impacts
B.  Summary of prevalence
C.  Why does this happen? Most texts are imcomplete (especially for stage-structured models) and/or have incosistent or confusing notation. Talk about @Caswell2001 as example. Also, these are "threshold concepts."
D.  Recommendations for practitioners:  
    1. Use prebreeding census whenever possible
    2. Unroll developmental stages (address sensitivity analysis challenges raised by Fujiwara and Diaz-Lopez, p. 2: "The inclusion of a large number of age-classes for long-lived organisms can make the interpretation of the sensitivity and elasticity analyses complicated because individuals in multiple age classes are often practically identical but separated in an age-structured model. Consequently, when long-lived organisms are studied, it is common to convert age-specific vital rates into stage-specific vital rates, and to use stage-structured population matrices for calculating $\lambda_1$ and generation time.")
E.  Recommendations for experts:
    1. Develop handbooks and training materials that are both comprehensive and clear to novices (reference threhshold concepts)
    2. Develop software tools to help guide practitioners through the process of translating demographic information in to MPMs

F.  Revisiting prior results
    1. Inidividual studies
    2. Syntheses

## Text about causes of confusion

This nomenclatural ambiguity plays a role in all three of the "accounting errors" that follow.
An additional challenge is that most textbooks use inconsistent notation and subscripting conventions for age- and stage-structured models.
Age-structured models follow a convention that makes sense for a continuously breeding species: an individual is assigned to an age class that is numbered with the individual's age at its *next* birthday (but note that this differs from colloquial use in most languages, where we identify a person's age with their *previous* birthday).
When looking at a species with discrete breeding seasons, this convention is perfectly fine for a pre-breeding census model, as all individuals are just a tiny fraction of a timestep away from their next birthday, and an individual that is almost three years old will have characteristics almost indistinguishable from one that is exactly three years old. [RSG: "a bit too verbose"]
In contrast, for a post-breeding census model, this convention would identify an individual that is just a tiny bit past its third birthday as a four-year-old.
This means that "$x$-year-old survival" (often denoted $P_x$) refers to survival from age $x$ to age $x+1$ in a pre-breeding census model, but from age $x-1$ to age $x$ in a post-breeding census model.

This is potentially confusing, but most practitioners do not move between these models so it is probably not a big issue.
However, transitioning from an age-structured model (which is what all texbooks use for a detailed explanation of MPMs) to a stage-structured model creates major challenges, at least for post-breeding census models.
This is because, whereas an individual that was $x$ years old at its recent birthday will be exactly $x+1$ years old at its next birthday, and can be unambiguously identified as "age class $x+1$," an individual that was in stage $x$ at its recent birthday might be in any of a number of stages at its next birthday, preventing the application of the age-structure convention.
The solution is for post-breeding census stage-structured models to assign individuals to the stage class they were in at their recent birthday (bearing in mind that the age is measured in time steps).
; since most animal MPMs are at least partially stage-structured, we suspect that textbooks' failure to force a confrontation with this cognitive dissonance in the conceptually simpler age-structured models leaves practitioners unprepared to face it (or even recognize its necessity) in stage-structured models.This is perfectly sensible, but *most textbooks make this transition without comment.* [CHECK WHAT MILLS DOES HERE]
Thus it is not obvious to a novice that the carefully explained conventions of age-structured models no longer apply; we suspect that this contributes to some of the common errors described below.
; since most animal MPMs are at least partially stage-structured, we suspect that textbooks' failure to force a confrontation with this cognitive dissonance in the conceptually simpler age-structured models leaves practitioners unprepared to face it (or even recognize its necessity) in stage-structured models.

## Text about birth-flow models
However, much of the theoretical development of MPMs was motivated by human demography, in which reproduction occurs throughout the year ("birth-flow" populations). 
This may require a variety of mathematical approximations to suitably transform continuous-time processes into a discrete-time representation, and gives a different view of the identity of individuals in a particular age or stage class. 
We will not treat the former here, but the latter is relevant. 

The discretization of age into classes means that in a birth-flow population, the first age class represents all individuals between zero and one timestep old at time $t$, and thus we would describe it as "Age 0--1." 

But we often see birth-pulse models in which the age classes are given as a range---this is incorrect, and leads to ambiguity (does the class "Age 0--1" refer to newborns or to one-year-olds?) that can confuse the practitioner on how best to construct the model. 
This nomenclature problem likely has two sources. First, many texts introduce birth-flow models first [e.g., the very first figure in @Caswell2001, illustrating the notion of discrete age classes, shows the classes as ages 0--1, 1--2, etc.]. 
Second, in colloquial use, age-associated terms often span an age range: for example, in ungulates the term "yearling" refers to any individual between the ages of one and two. 
When that same term is applied to a class in a birth-pulse MPM, nontrivial cognitive effort is required to mentally redefine it (so that "Yearling" means age exactly one). 

## Misc discussion items
- Paragraph about how AAS, SAS, and FAS models are related to each other [MF].
- Mention other types of errors in MPM construction
  - Inappropriate fecundity term (e.g., using birth-pulse for continuously breeding species)
  - Issues with size, esp. using observed transitions between size classes
  - Issues with seeds/seed banks

# Acknowledgments {.unnumbered}
This work was supported by [funding support to the compadrinos], a UCSB Faculty Senate grant to BEK, and [funding support to Masami & Jasmin]. We thank Rob Salguero-Gómez for feedback on the model evaluation protocol and manuscript, Dmitrii Logofet for feedback on the manuscript, and Sandra Schneider and Jakob Voigt at the Max Planck Institute for Demographic Research for carrying out the model evaluations.

# References {#references .unnumbered}

