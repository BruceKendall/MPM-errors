---
title: Persistent problems in the construction of matrix population models
author:
  - name: Bruce E. Kendall
    email: kendall@bren.ucsb.edu
    affiliation: UCSB Bren
    footnote: Corresponding Author
  - name: Masami Fujiwara
    email: fujiwara@tamu.edu
    affiliation: TAMU Wildlife
  - name: Jasmin Diaz-Lopez
    email: jasmindiazlopez@tamu.edu
    affiliation: TAMU Wildlife
address:
  - code: UCSB Bren
    address: Bren School of Environmental Science & Management, University of California Santa Barbara, Santa Barbara, CA 93106-5131, USA
  - code: TAMU Wildlife
    address: Department of Wildlife and Fisheries Sciences, Texas A&M University, College Station, TX 77843-2258, USA
abstract: |
  Matrix population models (MPMs) are powerful tools for translating demographic and life history information into a form that can be used to address a wide range of research topics, such as projecting population dynamics, evaluating stressor impacts on populations, and studying life history evolution. However, the reliability of such studies depends on the MPM being constructed in a way that accurately reflects the species’ life history. We highlight three errors commonly encountered in published MPMs: (1) failing to include survival as well as fertility in the reproduction term; (2) introducing a one-year delay in age at first reproduction; and (3) incorrectly calculating the growth transition rate out of a stage with a mean development time greater than the model time step. We review the sources of such errors and provide new analyses revealing the impact of such errors on model predictions. These MPM construction issues are treated extensively in textbooks, so their existence in current literature is surprising. To quantify the prevalence of such errors we examined and scored the original publications underlying the models in the COMADRE Animal Matrix Database. The first two errors were found in 41% and 42%, respectively, of the published studies; all were in models that used a “post-breeding census” representation of the life cycle graph (in which newborns [eggs, neonates, fledglings, etc.] are explicitly included). Of the studies where stages may last longer than one time step, 25% constructed the growth rate using inappropriate formulas, and 37% used methods that were either undescribed or would generate the correct development time only if the population remained at the observed within-stage age structure. These results suggest that further efforts may be required to educate biologists on the construction of MPMs, perhaps in concert with the development of new software tools. Furthermore, the conclusions of many studies that are based on MPMs may need to be re-examined, and synthetic studies using the COMADRE Database need to be undertaken with caution.

keywords: COMADRE animal matrix database, Lefkovitch matrix, Leslie matrix, Matrix population models
bibliography: Bibliography.bib
csl: ecological-modelling.csl
output: 
  bookdown::pdf_book:
    base_format: rticles::elsevier_article
    keep_tex: true
numbersections: true
layout: "12pt, 1p"
linenumbers: true
tables: true
journal: "Ecological Modelling"
---

# Introduction 
The use of matrix population models (MPMs) for the ecological study of plants and animals has expanded rapidly in recent years [@Salguero-Gomez2015; @Salguero-Gomez2016].
MPMs are a convenient way to synthesize demographic information about a population, and are useful in addressing ecological, evolutionary, and management questions [@Caswell2001; @Morris2002a].
Most early MPMs were developed by collaborations between biologists with expertise on the species at hand and modelers with deep understanding of the subtleties of modeling.
MPMs now, having been long promoted as a straightforward translation of life-history information into quantitative analysis, are often being created by biologists who are primarily empirical ecologists or conservation biologists, and may have had little training in modeling beyond a graduate course in population ecology.
One might then ask, do these MPMs reliably reproduce the life histories they are meant to represent? 

It is important to remember that MPMs are approximations, both because they still abstract away much biological detail and because demographic measurements are imprecise. 
There are a variety of subtleties in constructing such models, especially when breeding is spread across a substantial fraction of the year or when there is substantial heterogeneity among individuals within an age or stage class; much theoretical work has gone into making MPMs more complex to account for this, and we are starting to better understand the effects of these phenomena on simple models [e.g., @Fujiwara2017]. 
But even setting aside these issues, we might hope that, if we assume that a simple life history description (e.g., as embodied in an age- or stage-structured life table) is a useful description of the population, then the constructed MPM should accurately reproduce that description. 
If it does not, then we are introducing additional errors into the analysis above and beyond the inherent approximations of modeling.

One of us (BEK) has spent two decades teaching MPMs to applied masters students. 
This experience has revealed several aspects of MPM construction that are particularly challenging to novices, and thus might be similarly challenging to biologists who do not regularly create mathematical models of their system. 
Furthermore, the students, when sent to find a published model to analyze, have uncovered a suprising number of published MPMs that have failed to meet these challenges. 
At one level, the errors made by these novices are "simply" accounting issues, but our interpretation is that the difficulty that students have in overcoming them is rooted in the contrast between the often-loose way that terms are used to describe biological populations and the very precise meanings of terms in MPMs (together with some genuine linguistic ambiguity that plagues the field).

Our goal in this paper is to highlight these challenges (which are described in the next section), quantify their impacts on the outputs of MPMs, and document their prevalence in the peer-reviewed literature. 
We conclude with a discussion of why these MPM construction errors are so prevalent, and how we might improve future practice.

# Challenges in MPM construction
Matrix population models operate in discrete time, and as such are most naturally suited to species whose reproduction is concentrated in a short breeding season [so-called "birth-pulse" populations; @Caswell2001 *[did Caswell coin this phrase?]*]. 
Many animals and plants satisify this assumption, and we will focus on this case in our analysis. However, much of the theoretical development of MPMs was motivated by human demography, in which reproduction occurs throughout the year ("birth-flow" populations). 
This requires a variety of mathematical approximations to suitably transform continuous-time processes into a discrete-time representation, and gives a different view of the identity of individuals in a particular age or stage class. 
We will not treat the former here, but the latter is relevant. 

MPMs assume that the population at time $t$ is a snapshot at a particular "census date." 
The discretization of age into classes means that in a birth-flow population, the first age class represents all individuals between zero and one timestep old at time $t$, and thus we would describe it as "Age 0--1." 
In contrast, in a birth-pulse population, all individuals in an age class are (more-or-less) exactly the same age. 
If the census were taken immediately after the breeding season^[Defined as the season in which individuals are born, not the season during which their parents mate.] (a "post-breeding census"), the first age class would comprise newborn individuals, all of age zero, the second class would comprise individuals of age exactly one, etc.^[In principle, the census could occur at any time relative to the breeding season, and @Caswell2001 provides general formulas to account for this; but in practice the two cases described here encompass nearly all, if not all, published birth-pulse models.] 
In contrast, if the census were taken immediately before the breeding season (a "pre-breeding census"), the youngest age class would be made up of individuals all with age exactly one. 
But we often see birth-pulse models in which the age classes are given as a range---this is incorrect, and leads to ambiguity (does the class "Age 0--1" refer to newborns or to one-year-olds?) that can confuse the practitioner on how best to construct the model. 
This nomenclature problem likely has two sources. First, many texts introduce birth-flow models first [e.g., the very first figure in @Caswell2001, illustrating the notion of discrete age classes, shows the classes as ages 0--1, 1--2, etc.]. Second, in colloquial use, age-associated terms often span an age range: for example, in ungulates the term "yearling" refers to any individual between the ages of one and two. 
When that same term is applied to a class in a birth-pulse MPM, nontrivial cognitive effort is required to mentally redefine it (so that "Yearling" means age exactly one). 

This nomenclatural ambiguity plays a role in all three of the "accounting errors" that follow.
An additional challenge is that most textbooks use inconsistent notation and subscripting conventions for age- and stage-structured models.
Age-structured models follow a convention that makes sense for a continuously breeding species: an individual is assigned to an age class that is numbered with the individual's age at its *next* birthday (but note that this differs from colloquial use in most languages, where we identify a person's age with their *previous* birthday).
When looking at a species with discrete breeding seasons, this convention is perfectly fine for a pre-breeding census model, as all individuals are just a tiny fraction of a timestep away from their next birthday, and an individual that is almost three years old will have characteristics almost indistinguishable from one that is exactly three years old.
In contrast, for a post-breeding census model, this convention would identify an individual that is just a tiny bit past its third birthday as a four-year-old.
This means that "$x$-year-old survival" (often denoted $P_x$) refers to survival from age $x$ to age $x+1$ in a pre-breeding census model, but from age $x-1$ to age $x$ in a post-breeding census model.

This is potentially confusing, but most practitioners don't move between these models so it is probably not a large issue.
However, transitioning from an age-structured model (which is what all texbooks use for a detailed explanation of MPMs) to a stage-structured model creates huge problems, at least for post-breeding census models.
This is because, whereas an individual that was $x$ years old at its recent birthday will be exactly $x+1$ years old at its next birthday, and can be unambiguously identified as "age class $x+1$," an individual that was in stage $x$ at its recent birthday might be in any of a number of stages at its next birthday, preventing the application of the age-structure convention.
The solution is for post-breeding census stage structured models to assign individuals to the stage class they were in at their recent birthday.
This is perfectly sensible, but *most textbooks make this transition without comment.* [CHECK WHAT MILLS DOES HERE]
Thus it is not obvious to a novice that the carefully-explained conventions of age-structured models no longer apply; we suspect that this contributes to some of the common errors described below.

To avoid the need to be pedantic when moving between age- and stage-structured models, we will apply the stage-structured convention to age-structured models.
Thus, in a post-breeding census, individuals that have just been born are classified as "age zero" or "newborn," with a subscript of zero.
This will make our exposition clearer, but it is important to note that our lifetables and age-structured models will therefor look different from most textbooks.

## Ensuring that the fertility transition spans a full timestep
In a life table (e.g., Table \ref{tab:lifetable}, age specific survival and birth rates look functionally equivalent. 
But there is an important difference: survival (often denoted $P_x$ (most common, but has a different meaning in stage-structured models), $s_x$, or $\sigma_x$, where $x$ is the age or stage; we will use $\sigma_x$) represents the fraction of individuals in class $x$ that survive for a full timestep, from time $t$ to time $t+1$. 
In contrast, the birth rate (typically denoted $b_x$ or $m_x$; we use the former) is instantaneous: it is the number of of offspring produced at time $t$ by an individual that is alive at time $t$. 
It is tempting to draw a life-cycle diagram like the one in Fig. \@ref(fig:lifecycles)a (and we commonly see that in the literature). 
While this works as a *conceptual* diagram, translating it directly into an MPM by coverting each arrow in the graph into a matrix element is incorrect: each transition in the matrix must span a timestep, and $m_x$ does not accomplish that. 
```{r lifetable, results='markup', echo=FALSE}
### Make and display a sample life table
sample_life_table <- data.frame(
  Age = c(0:4, "$\\vdots$"),
  Survival = c(0.2, 0.4, 0.4, 0.9, 0.9, "$\\vdots$"),
  Birth = c(0, 0, 0, 3, 3, "$\\vdots$"),
  Stage = c("Newborn", "Juvenile", "Juvenile", "Adult", "Adult",
            "$\\vdots$")
)

names(sample_life_table) <- c("Age in years ($x$)", 
                              "Annual survival ($\\sigma_x$)",
                              "Birth rate ($b_x$)",
                              "Stage")
knitr::kable(sample_life_table, escape = FALSE,
             booktabs = TRUE,  align = c("c", "c", "c", "c"),
             caption = "A sample life table for a species that
             reaches sexual maturity at age 3 (adult stage). 
             Adults continue to survive and
             reproduce indefinitely with the same survival 
             and birth rates.
             Note that, because we are using the 
             stage-structured convention for assigning age 
             class names (see text), the table may look slightly
             different from those in many textbooks.")
```

```{r lifecycles, echo=FALSE, warning=FALSE, message=FALSE, fig.cap='Four life-cycle diagrams that might (or might not) represent the life table in Table 1. (a) A "naive" representation that associates each arrow with a vital rate. This fails to account for the fact that the reproductive transitions must span a timestep and therefor include a survival term. (b) A pre-breeding census representation, in which the youngest censused class is Age 1 and the adult birth rate is multiplied by newborn survival. (c) A post-breeding census representation, in which the adult burth rate is correctly multiplied by adult survival, but which fails to account for the fact that Age 2 individuals will have reproduced (as adults) just prior to the next census. (d) A correct post-breeding census representation.'}
library(diagram)
class_names <- c("Age 0", "Age 1", "Age 2", "Adult")
op <- par(mfrow = c(2,2), mar = c(0.1, 0.1, 1.6, 0.1))

# Common control paramters for the diagrams
# Set them once here so that they can be easily updated
# Unfortunately plotmat() is not scale-independent!
pos = 4
self.shiftx = 0.15
self.shifty = -0.08
self.lwd = 2
self.lwd = 2
self.cex = 1
self.arrpos = NULL
shadow.size = 0.0
relsize = 0.89
mx = -0.05
arr.type = "triangle"
arr.length = 0.2

# "Naive" life cycle diagram
mat1 <- as.data.frame(
  matrix(nrow = 4, ncol = 4, byrow = TRUE, data = 0)
)
mat1[[2,1]] <- "sigma[0]"
mat1[[3,2]] <- "sigma[1]"
mat1[[4,3]] <- "sigma[2]"
mat1[[4,4]] <- "sigma[3]"
mat1[[1,4]] <- "b[3]"
curves <- matrix(0, 4, 4)
curves[2,1] <- curves[3,2] <- curves[4,3] <- 1
curves[1,4] <- 0.5
plotmat(mat1, name = class_names, pos = pos, curve = curves, 
        self.shiftx = self.shiftx, self.shifty = self.shifty, 
        self.lwd = self.lwd, self.cex = self.cex, 
        self.arrpos = self.arrpos, shadow.size = shadow.size, 
        relsize = relsize, mx = mx, arr.type = arr.type,  
        arr.length = arr.length,
        main = "\na) Naive representation (incorrect)")

# Pre-breeding census 
mat2 <- mat1[-1,-1]
mat2[[1,3]] <- "b[3] * sigma[0]"
curves2 <- curves[-1,-1]
curves2[1,3] <- 0.5

plotmat(mat2, name = class_names[-1], pos = 3, curve = curves2, 
        self.shiftx = self.shiftx, self.shifty = self.shifty, 
        self.lwd = self.lwd, self.cex = self.cex, 
        self.arrpos = self.arrpos, shadow.size = shadow.size, 
        relsize = relsize, mx = mx, arr.type = arr.type,  
        arr.length = arr.length,
        main = "\nb) Pre-breeding census representation (correct)")

# Incorrect post-breeding census
mat3 <- mat1
mat3[[1,4]] <- "sigma[3] * b[3]"
plotmat(mat3, name = class_names, pos = pos, curve = curves, 
        self.shiftx = self.shiftx, self.shifty = self.shifty, 
        self.lwd = self.lwd, self.cex = self.cex, 
        self.arrpos = self.arrpos, shadow.size = shadow.size, 
        relsize = relsize, mx = mx, arr.type = arr.type,  
        arr.length = arr.length,
        main = "c) Post-breeding census representation \n(incorrect)")

# Correct post-breeding census
mat4 <- mat3
mat4[[1,3]] <- "sigma[2] * b[3]"
curves[1,3] <- curves[1,4]
plotmat(mat4, name = class_names, pos = pos, curve = curves, 
        self.shiftx = self.shiftx, self.shifty = self.shifty, 
        self.lwd = self.lwd, self.cex = self.cex, 
        self.arrpos = self.arrpos, shadow.size = shadow.size, 
        relsize = relsize, mx = mx, arr.type = arr.type,  
        arr.length = arr.length,
        main = "d) Post-breeding census representation \n(correct)")

par(op)
```

To get the timestep in there, we need to multiply $b_x$ by somebody's survival---either the parent or the offspring. 
For a pre-breeding census model, the reproductive transition is $F_x = b_x \sigma_0$: the parent, in class $x$, produces $b_x$ offspring immediately after the census, and then these offspring survive to the end of the timestep at rate $\sigma_0$ (Fig. \@ref(fig:lifecycles)b). 
For an annual timestep, the transition $F_x$ represents the number of one-year-olds next year produced by an individual in class $x$ this year. 

In a post-breeding census, the parent (which will have just reproduced if it is already an adult) must survive for a timestep, aging by a timestep and possibly maturing into a new class, and then reproduces with a birth rate appropriate to its class at the end of the timestep. 
If we use $x'$ to denote the parent's class at time $t+1$, then the transision is $F_x = \sigma_x b_{x'}$ (Fig. \@ref(fig:lifecycles)d). For an annual timestep, $F_x$ is the number of zero-year-olds (newborns) next year produced next year by an individual that was in class $x$ this year. 
Properly accounting for $x'$ is a separate challenge that we address in the next subsection.


## Matching the age at first reproduction to the species' life history

## Ensuring that the mean time in each developmental stage matches the species' life history

# Consequences of incorrect MPM construction
We evaluate the impacts of these errors in MPM construction by examining several endpoints that many analyses focus on: the asymptotic population growth rate ($\lambda$), sensitivity analysis of $\lambda$ to changes in underlying vital rates, and life history statistics such as generation time. 
We approach this evaluation through theoretical analysis (where feasible and informative) and by examining two case studies: a lionfish (*Pterois* sp.) model with very high population growth [@Morris2011], and a pair of American alligator (*Alligator mississippiensis*) with rapdily declining and nearly constant population dynamics, respectively [@Dunham2014]. 
These studies made all three of the errors described above; we singled them out not because they are particularly egregious (many other studies make these errors) but because they do an exceptional job of describing the species' life history, allowing us to infer the model they meant to construct.
All three of these models had other minor errors, which we corrected (while retaining the three focal errors) to create "baseline" models. 
We then constructed models that fixed one, two, or three of the focal errors to see how these errors affect the model projections and conclusions.
A full description of these models, and all outputs, are in Appendix A.

## Effects on asymptotic population growth rate ($\lambda$) 

## Effects on sensitivity analysis of $\lambda$

## Effects on life history statistics

# Prevalence of construction errors in published MPMs
## Methods
Sampling of COMADRE/COMPADRE

Questions related to fertility

Questions related to first reproduction

Questions related to maturation

Statistical analysis: means, trends through time

## Results
Fertility

First reproduction

Maturation

# Discussion
Summary of impacts

Summary of prevalence

Why does this happen? Most texts are imcomplete (especially for stage-structured models) and/or have incosistent or confusing notation. Pick on Caswell as example. Also, these are "threshold concepts."

Recommendations for practitioners:  

1. Use prebreeding census whenever possible
2. Unroll developmental stages (address sensitivity analysis challenges raised by Fujiwara and Diaz-Lopez, p. 2: "The inclusion of a large number of age-classes for long-lived organisms can make the interpretation of the sensitivity and elasticity analyses complicated because individuals in multiple age classes are often practically identical but separated in an age-structured model. Consequently, when long-lived organisms are studied, it is common to convert age-specific vital rates into stage-specific vital rates, and to use stage-structured population matrices for calculating $\lambda$ and generation time.")

Recommendations for experts:

1. Develop handbooks and training materials that are both comprehensive and clear to novices (reference threhshold concepts)
2. Develop software tools to help guide practitioners through the process of translating demographic information in to MPMs

Revisiting prior results

- Inidividual studies
- Syntheses

# Acknowledgments {.unnumbered}
This work was supported by [funding support to the compadrinos], a UCSB Faculty Senate grant to BEK, and [funding support to Masami & Jasmin]. We thank Rob Salguero-Gómez for feedback on the model evaluation protocol, and [list of compadrinos who actually worked on the project] for carrying out the model evaluations.

# References {#references .unnumbered}

